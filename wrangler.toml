# GrowPod Empire - Cloudflare Workers Configuration
# Documentation: https://developers.cloudflare.com/workers/wrangler/configuration/

name = "growpod-empire"
main = "src/worker.ts"
compatibility_date = "2026-01-01"
compatibility_flags = ["nodejs_compat"]

# Serve static assets from the dist folder
[site]
bucket = "./dist/public"

# ============================================
# REQUIRED: Add your Cloudflare Account ID
# ============================================
# Get this from: https://dash.cloudflare.com/ → Workers & Pages → Overview (right sidebar)
account_id = "YOUR_CLOUDFLARE_ACCOUNT_ID"

# ============================================
# Environment Variables
# ============================================
# These can also be set in the Cloudflare dashboard under Workers → Settings → Variables

[vars]
NODE_ENV = "production"
# VITE_GROWPOD_APP_ID = "754825112"
# VITE_BUD_ASSET_ID = "754825127"
# VITE_TERP_ASSET_ID = "754825128"
# VITE_SLOT_ASSET_ID = "754825129"
# VITE_GROWPOD_APP_ADDRESS = "6P55NJ7FDJSZA2YSZNT2HRF2FBIUYNKBZLPX4LJ72Q76SBDN4VAB65W6KM"

# ============================================
# Secrets (set via `wrangler secret put <NAME>`)
# ============================================
# Run these commands to set secrets:
#   wrangler secret put DATABASE_URL
#   wrangler secret put ALGO_MNEMONIC
#   wrangler secret put ADMIN_WALLET_ADDRESS
#   wrangler secret put SECURITY_EMAIL
#   wrangler secret put RESEND_API_KEY

# ============================================
# D1 Database (Cloudflare's SQLite)
# ============================================
# Create database: wrangler d1 create growpod-empire-db
# Then add the database_id returned by that command below:
[[d1_databases]]
binding = "DB"
database_name = "growpod-empire-db"
database_id = "YOUR_D1_DATABASE_ID"  # Replace after running: wrangler d1 create growpod-empire-db

# ============================================
# KV Namespaces (for caching and security metrics)
# ============================================
# Create with: wrangler kv:namespace create "CACHE"
# [[kv_namespaces]]
# binding = "CACHE"
# id = "YOUR_KV_NAMESPACE_ID"

# Create with: wrangler kv:namespace create "SECURITY_KV"
# [[kv_namespaces]]
# binding = "SECURITY_KV"
# id = "YOUR_SECURITY_KV_NAMESPACE_ID"

# ============================================
# R2 Storage (for NFT images/metadata)
# ============================================
# [[r2_buckets]]
# binding = "NFT_STORAGE"
# bucket_name = "growpod-nft-assets"

# ============================================
# Build Configuration
# ============================================
[build]
command = "npm run build"

# ============================================
# Development Server
# ============================================
[dev]
port = 8787
local_protocol = "http"

# ============================================
# Production Environment
# ============================================
[env.production]
name = "growpod-empire-prod"
# Add production-specific variables here

# ============================================
# Staging Environment
# ============================================
[env.staging]
name = "growpod-empire-staging"
# Add staging-specific variables here

# ============================================
# Routes (if using custom domain)
# ============================================
# routes = [
#   { pattern = "growpod.empire/*", zone_name = "yourdomain.com" }
# ]

# ============================================
# Observability
# ============================================
[observability]
enabled = true

# ============================================
# Limits
# ============================================
# Workers have execution limits:
# - CPU time: 10ms (free) / 30s (paid)
# - Memory: 128MB
# - Subrequest limit: 50 (free) / 1000 (paid)

# ============================================
# Cron Triggers (for scheduled tasks)
# ============================================
# Uncomment to enable security monitoring scheduled reports
# [triggers]
# crons = ["*/5 * * * *"]  # Every 5 minutes - adjust as needed
# Available patterns:
#   "*/5 * * * *"  - Every 5 minutes
#   "0 * * * *"    - Every hour
#   "0 */6 * * *"  - Every 6 hours
#   "0 9 * * *"    - Daily at 9 AM UTC

# ============================================
# Security Monitor Worker (separate deployment)
# ============================================
# To deploy the security monitor as a separate worker:
#   wrangler deploy src/security-monitor.ts --name growpod-security-monitor
#
# Or create a separate wrangler.security.toml with:
#   name = "growpod-security-monitor"
#   main = "src/security-monitor.ts"
#   [triggers]
#   crons = ["*/5 * * * *"]
