# GrowPod Empire - Security Monitor Worker Configuration
# Deploy with: wrangler deploy -c wrangler.security.toml

name = "growpod-security-monitor"
main = "src/security-monitor.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# ============================================
# Account ID (same as main worker)
# ============================================
# For local deploys, pass your account explicitly:
#   wrangler deploy -c wrangler.security.toml --account-id YOUR_ACCOUNT_ID
# Alternatively, create an untracked local config (e.g. wrangler.security.local.toml)
# with `account_id` set, and use `-c` to point Wrangler at it.
# In GitHub Actions, `cloudflare/wrangler-action` reads CLOUDFLARE_ACCOUNT_ID
# and supplies `accountId` to Wrangler.
#
# account_id = ""  # DO NOT commit your account ID to version control

# ============================================
# Scheduled Triggers
# ============================================
[triggers]
crons = ["*/5 * * * *"]  # Every 5 minutes

# ============================================
# D1 Database (same as main app)
# ============================================
# Note: src/security-monitor.ts requires env.DB binding.
# For local development, create wrangler.security.local.toml with the database_id set.
# For production deploys, ensure CI/CD provides the D1 binding.
#
# [[d1_databases]]
# binding = "DB"
# database_name = "growpod-empire-db"
# database_id = ""  # Add your D1 database ID here or in wrangler.security.local.toml

# ============================================
# KV Namespace for metrics storage
# ============================================
# Create with: wrangler kv:namespace create "SECURITY_KV"
# [[kv_namespaces]]
# binding = "SECURITY_KV"
# id = "YOUR_SECURITY_KV_NAMESPACE_ID"

# ============================================
# Environment Variables
# ============================================
[vars]
NODE_ENV = "production"

# ============================================
# Secrets (set via wrangler)
# ============================================
# Required for email reports:
#   wrangler secret put SECURITY_EMAIL -c wrangler.security.toml
#   wrangler secret put RESEND_API_KEY -c wrangler.security.toml
#
# Alternative email services:
# - SendGrid: wrangler secret put SENDGRID_API_KEY
# - Mailgun: wrangler secret put MAILGUN_API_KEY
# - Cloudflare Email Workers: Configure in dashboard

# ============================================
# Observability
# ============================================
[observability]
enabled = true
